<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-04-17">

<title>Lab 1.Exercise</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="Lab1-Exercise1_files/libs/clipboard/clipboard.min.js"></script>
<script src="Lab1-Exercise1_files/libs/quarto-html/quarto.js"></script>
<script src="Lab1-Exercise1_files/libs/quarto-html/popper.min.js"></script>
<script src="Lab1-Exercise1_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Lab1-Exercise1_files/libs/quarto-html/anchor.min.js"></script>
<link href="Lab1-Exercise1_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Lab1-Exercise1_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Lab1-Exercise1_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Lab1-Exercise1_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Lab1-Exercise1_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#exercise" id="toc-exercise" class="nav-link active" data-scroll-target="#exercise">Exercise</a></li>
  <li><a href="#solution-using-tree" id="toc-solution-using-tree" class="nav-link" data-scroll-target="#solution-using-tree">Solution using <code>tree</code></a></li>
  <li><a href="#solution-using-rpart" id="toc-solution-using-rpart" class="nav-link" data-scroll-target="#solution-using-rpart">Solution using <code>rpart</code></a></li>
  <li><a href="#solution-using-caret" id="toc-solution-using-caret" class="nav-link" data-scroll-target="#solution-using-caret">Solution using <code>caret</code></a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 1.Exercise</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Adapted by EVL, FRC and ASP </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 17, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="exercise" class="level1">
<h1>Exercise</h1>
<p>This problem involves the <span class="math inline">\(OJ\)</span> data set which is part of the ISLR2 package.</p>
<ol type="a">
<li>Create a training set containing a random sample of 800 observations, and a test set containing the remaining observations.</li>
<li>Use the <code>tree</code> package to fit a tree to the training data, with Purchase as the response and the other variables as predictors. Use the summary () function to produce summary statistics about the tree, and describe the results obtained. What is the training error rate? How many terminal nodes does the tree have?</li>
<li>Type in the name of the tree object in order to get a detailed text output. Pick one of the terminal nodes, and interpret the information displayed.</li>
<li>Create a plot of the tree, and interpret the results.</li>
<li>Use the tree package to predict the response on the test data, and produce a confusion matrix comparing the test labels to the predicted test labels. What is the test error rate?</li>
<li>Apply the cv.tree() function to the training set in order to determine the optimal tree size.</li>
<li>Produce a plot with tree size on the <span class="math inline">\(x\)</span>-axis and cross-validated classification error rate on the <span class="math inline">\(y\)</span>-axis.</li>
<li>Which tree size corresponds to the lowest cross-validated classification error rate?</li>
<li>Produce a pruned tree corresponding to the optimal tree size obtained using cross-validation. If cross-validation does not lead to selection of a pruned tree, then create a pruned tree with five terminal nodes.</li>
<li>Compare the training error rates between the pruned and unpruned trees. Which is higher?</li>
</ol>
<p>Once you have solved the exercise, try to repeat it using another R package, either <code>rpàrt</code> or <code>caret</code>. Compare the results obtained and comment about the differences observed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="solution-using-tree" class="level1">
<h1>Solution using <code>tree</code></h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the ISLR2 package and the OJ data set</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR2)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(OJ)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a training set containing a random sample of 800 observations, and a test set containing the remaining observations</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>train_idx <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(OJ), <span class="dv">800</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>OJ_train <span class="ot">&lt;-</span> OJ[train_idx, ]</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>OJ_test <span class="ot">&lt;-</span> OJ[<span class="sc">-</span>train_idx, ]</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a tree to the training data, with Purchase as the response and the other variables as predictors</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tree)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>tree <span class="ot">&lt;-</span> <span class="fu">tree</span>(Purchase <span class="sc">~</span> ., <span class="at">data =</span> OJ_train)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the summary() function to produce summary statistics about the tree, and describe the results obtained</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(tree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
tree(formula = Purchase ~ ., data = OJ_train)
Variables actually used in tree construction:
[1] "LoyalCH"       "PriceDiff"     "SpecialCH"     "ListPriceDiff"
[5] "PctDiscMM"    
Number of terminal nodes:  9 
Residual mean deviance:  0.7432 = 587.8 / 791 
Misclassification error rate: 0.1588 = 127 / 800 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Training error rate for unpruned tree:"</span>, tree<span class="sc">$</span>dev<span class="sc">/</span><span class="fu">sum</span>(tree<span class="sc">$</span>frame<span class="sc">$</span>wt), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Training error rate for unpruned tree:  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Number of terminal nodes in unpruned tree:"</span>, tree<span class="sc">$</span>frame<span class="sc">$</span>var[tree<span class="sc">$</span>frame<span class="sc">$</span>var <span class="sc">==</span> <span class="st">"&lt;leaf&gt;"</span>] <span class="sc">%&gt;%</span> length, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of terminal nodes in unpruned tree: 9 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a plot of the tree</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tree)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(tree, <span class="at">pretty =</span> <span class="dv">0</span>, <span class="at">cex=</span><span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Lab1-Exercise1_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="768"></p>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict the response on the test data, and produce a confusion matrix comparing the test labels to the predicted test labels</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>test_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(tree, OJ_test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(test_preds, OJ_test<span class="sc">$</span>Purchase)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          
test_preds  CH  MM
        CH 160  38
        MM   8  64</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the test error rate</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>test_error_unpruned <span class="ot">&lt;-</span> <span class="fu">mean</span>(test_preds <span class="sc">!=</span> OJ_test<span class="sc">$</span>Purchase)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Test error rate for unpruned tree:"</span>, test_error_unpruned, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test error rate for unpruned tree: 0.1703704 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the cv.tree() function of the tree package to the training set in order to determine the optimal tree size</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>cv <span class="ot">&lt;-</span> <span class="fu">cv.tree</span>(tree, <span class="at">FUN =</span> prune.misclass)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Give the code to Produce a plot with tree size on the x-axis and cross-validated classification error rate on the y-axis</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cv<span class="sc">$</span>size, cv<span class="sc">$</span>dev, <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">xlab =</span> <span class="st">"Tree Size"</span>, <span class="at">ylab =</span> <span class="st">"Cross-Validated Error Rate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Lab1-Exercise1_files/figure-html/unnamed-chunk-2-2.png" class="img-fluid" width="768"></p>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the tree package to Produce a pruned tree corresponding to the optimal tree size obtained using cross-validation</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>pruned_tree <span class="ot">&lt;-</span> <span class="fu">prune.misclass</span>(tree, <span class="at">best =</span> cv<span class="sc">$</span>size[<span class="fu">which.min</span>(cv<span class="sc">$</span>dev)])</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># If cross-validation does not select a pruned tree, create a tree with five terminal nodes</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">is.null</span>(pruned_tree)) {</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  pruned_tree <span class="ot">&lt;-</span> <span class="fu">prune.misclass</span>(tree, <span class="at">best =</span> <span class="dv">8</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the training error rates between the pruned and unpruned trees</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>train_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(tree, OJ_train, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>train_error_unpruned <span class="ot">&lt;-</span> <span class="fu">mean</span>(train_preds <span class="sc">!=</span> OJ_train<span class="sc">$</span>Purchase)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Training error rate for unpruned tree:"</span>, train_error_unpruned, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Training error rate for unpruned tree: 0.15875 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>train_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(pruned_tree, OJ_train, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>train_error_pruned <span class="ot">&lt;-</span> <span class="fu">mean</span>(train_preds <span class="sc">!=</span> OJ_train<span class="sc">$</span>Purchase)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Training error rate for pruned tree:"</span>, train_error_pruned, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Training error rate for pruned tree: 0.1625 </code></pre>
</div>
</div>
</section>
<section id="solution-using-rpart" class="level1">
<h1>Solution using <code>rpart</code></h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the necessary packages</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># load the OJ dataset</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(OJ)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># split the data into training and test sets</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(OJ), <span class="dv">800</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> OJ[train, ]</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> OJ[<span class="sc">-</span>train, ]</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co"># fit a decision tree to the training data</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>tree_model <span class="ot">&lt;-</span> <span class="fu">rpart</span>(Purchase <span class="sc">~</span> ., <span class="at">data =</span> train_data, <span class="at">method =</span> <span class="st">"class"</span>)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize the tree model</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(tree_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rpart(formula = Purchase ~ ., data = train_data, method = "class")
  n= 800 

          CP nsplit rel error    xerror       xstd
1 0.49201278      0 1.0000000 1.0000000 0.04410089
2 0.03514377      1 0.5079872 0.5335463 0.03672576
3 0.02555911      2 0.4728435 0.5335463 0.03672576
4 0.01277955      4 0.4217252 0.4504792 0.03443205
5 0.01000000      7 0.3833866 0.4728435 0.03508854

Variable importance
       LoyalCH        StoreID      PriceDiff    SalePriceMM WeekofPurchase 
            45              9              9              6              6 
       PriceMM         DiscMM      PctDiscMM        PriceCH  ListPriceDiff 
             5              5              4              4              3 
   SalePriceCH          STORE      SpecialCH 
             2              1              1 

Node number 1: 800 observations,    complexity param=0.4920128
  predicted class=CH  expected loss=0.39125  P(node) =1
    class counts:   487   313
   probabilities: 0.609 0.391 
  left son=2 (450 obs) right son=3 (350 obs)
  Primary splits:
      LoyalCH   &lt; 0.5036    to the right, improve=134.49530, (0 missing)
      StoreID   &lt; 3.5       to the right, improve= 40.88655, (0 missing)
      STORE     &lt; 0.5       to the left,  improve= 20.84871, (0 missing)
      Store7    splits as  RL, improve= 20.84871, (0 missing)
      PriceDiff &lt; 0.015     to the right, improve= 19.14298, (0 missing)
  Surrogate splits:
      StoreID        &lt; 3.5       to the right, agree=0.660, adj=0.223, (0 split)
      WeekofPurchase &lt; 246.5     to the right, agree=0.625, adj=0.143, (0 split)
      PriceCH        &lt; 1.825     to the right, agree=0.600, adj=0.086, (0 split)
      PriceMM        &lt; 1.89      to the right, agree=0.596, adj=0.077, (0 split)
      ListPriceDiff  &lt; 0.035     to the right, agree=0.581, adj=0.043, (0 split)

Node number 2: 450 observations,    complexity param=0.03514377
  predicted class=CH  expected loss=0.1355556  P(node) =0.5625
    class counts:   389    61
   probabilities: 0.864 0.136 
  left son=4 (423 obs) right son=5 (27 obs)
  Primary splits:
      PriceDiff   &lt; -0.39     to the right, improve=18.543390, (0 missing)
      DiscMM      &lt; 0.72      to the left,  improve= 9.309254, (0 missing)
      SalePriceMM &lt; 1.435     to the right, improve= 9.309254, (0 missing)
      PctDiscMM   &lt; 0.3342595 to the left,  improve= 9.309254, (0 missing)
      LoyalCH     &lt; 0.7645725 to the right, improve= 8.822549, (0 missing)
  Surrogate splits:
      DiscMM      &lt; 0.72      to the left,  agree=0.967, adj=0.444, (0 split)
      SalePriceMM &lt; 1.435     to the right, agree=0.967, adj=0.444, (0 split)
      PctDiscMM   &lt; 0.3342595 to the left,  agree=0.967, adj=0.444, (0 split)
      SalePriceCH &lt; 2.075     to the left,  agree=0.949, adj=0.148, (0 split)

Node number 3: 350 observations,    complexity param=0.02555911
  predicted class=MM  expected loss=0.28  P(node) =0.4375
    class counts:    98   252
   probabilities: 0.280 0.720 
  left son=6 (180 obs) right son=7 (170 obs)
  Primary splits:
      LoyalCH   &lt; 0.2761415 to the right, improve=14.991900, (0 missing)
      StoreID   &lt; 3.5       to the right, improve= 6.562913, (0 missing)
      Store7    splits as  RL, improve= 4.617311, (0 missing)
      STORE     &lt; 0.5       to the left,  improve= 4.617311, (0 missing)
      SpecialCH &lt; 0.5       to the right, improve= 4.512108, (0 missing)
  Surrogate splits:
      STORE       &lt; 1.5       to the left,  agree=0.629, adj=0.235, (0 split)
      StoreID     &lt; 1.5       to the left,  agree=0.589, adj=0.153, (0 split)
      PriceCH     &lt; 1.875     to the left,  agree=0.589, adj=0.153, (0 split)
      SalePriceCH &lt; 1.875     to the left,  agree=0.586, adj=0.147, (0 split)
      SalePriceMM &lt; 1.84      to the left,  agree=0.571, adj=0.118, (0 split)

Node number 4: 423 observations
  predicted class=CH  expected loss=0.09929078  P(node) =0.52875
    class counts:   381    42
   probabilities: 0.901 0.099 

Node number 5: 27 observations
  predicted class=MM  expected loss=0.2962963  P(node) =0.03375
    class counts:     8    19
   probabilities: 0.296 0.704 

Node number 6: 180 observations,    complexity param=0.02555911
  predicted class=MM  expected loss=0.4222222  P(node) =0.225
    class counts:    76   104
   probabilities: 0.422 0.578 
  left son=12 (106 obs) right son=13 (74 obs)
  Primary splits:
      PriceDiff     &lt; 0.05      to the right, improve=12.110850, (0 missing)
      SalePriceMM   &lt; 2.04      to the right, improve=11.572070, (0 missing)
      DiscMM        &lt; 0.25      to the left,  improve= 5.760121, (0 missing)
      PctDiscMM     &lt; 0.1345485 to the left,  improve= 5.760121, (0 missing)
      ListPriceDiff &lt; 0.18      to the right, improve= 5.597236, (0 missing)
  Surrogate splits:
      SalePriceMM   &lt; 1.94      to the right, agree=0.933, adj=0.838, (0 split)
      DiscMM        &lt; 0.08      to the left,  agree=0.822, adj=0.568, (0 split)
      PctDiscMM     &lt; 0.038887  to the left,  agree=0.822, adj=0.568, (0 split)
      ListPriceDiff &lt; 0.135     to the right, agree=0.800, adj=0.514, (0 split)
      PriceMM       &lt; 2.04      to the right, agree=0.783, adj=0.473, (0 split)

Node number 7: 170 observations
  predicted class=MM  expected loss=0.1294118  P(node) =0.2125
    class counts:    22   148
   probabilities: 0.129 0.871 

Node number 12: 106 observations,    complexity param=0.01277955
  predicted class=CH  expected loss=0.4245283  P(node) =0.1325
    class counts:    61    45
   probabilities: 0.575 0.425 
  left son=24 (8 obs) right son=25 (98 obs)
  Primary splits:
      LoyalCH        &lt; 0.3084325 to the left,  improve=3.118983, (0 missing)
      WeekofPurchase &lt; 247.5     to the right, improve=2.489639, (0 missing)
      SpecialMM      &lt; 0.5       to the left,  improve=2.454538, (0 missing)
      PriceCH        &lt; 1.755     to the right, improve=2.048863, (0 missing)
      PriceMM        &lt; 2.04      to the right, improve=1.514675, (0 missing)

Node number 13: 74 observations
  predicted class=MM  expected loss=0.2027027  P(node) =0.0925
    class counts:    15    59
   probabilities: 0.203 0.797 

Node number 24: 8 observations
  predicted class=CH  expected loss=0  P(node) =0.01
    class counts:     8     0
   probabilities: 1.000 0.000 

Node number 25: 98 observations,    complexity param=0.01277955
  predicted class=CH  expected loss=0.4591837  P(node) =0.1225
    class counts:    53    45
   probabilities: 0.541 0.459 
  left son=50 (46 obs) right son=51 (52 obs)
  Primary splits:
      LoyalCH        &lt; 0.442144  to the right, improve=3.071463, (0 missing)
      WeekofPurchase &lt; 248.5     to the right, improve=2.208454, (0 missing)
      SpecialMM      &lt; 0.5       to the left,  improve=2.011796, (0 missing)
      STORE          &lt; 0.5       to the left,  improve=1.624324, (0 missing)
      StoreID        &lt; 5.5       to the right, improve=1.624324, (0 missing)
  Surrogate splits:
      WeekofPurchase &lt; 255       to the left,  agree=0.622, adj=0.196, (0 split)
      SalePriceCH    &lt; 1.755     to the right, agree=0.571, adj=0.087, (0 split)
      STORE          &lt; 2.5       to the right, agree=0.571, adj=0.087, (0 split)
      PriceMM        &lt; 2.205     to the right, agree=0.561, adj=0.065, (0 split)
      DiscCH         &lt; 0.115     to the left,  agree=0.561, adj=0.065, (0 split)

Node number 50: 46 observations
  predicted class=CH  expected loss=0.326087  P(node) =0.0575
    class counts:    31    15
   probabilities: 0.674 0.326 

Node number 51: 52 observations,    complexity param=0.01277955
  predicted class=MM  expected loss=0.4230769  P(node) =0.065
    class counts:    22    30
   probabilities: 0.423 0.577 
  left son=102 (8 obs) right son=103 (44 obs)
  Primary splits:
      SpecialCH      &lt; 0.5       to the right, improve=2.020979, (0 missing)
      STORE          &lt; 1.5       to the left,  improve=1.724009, (0 missing)
      SpecialMM      &lt; 0.5       to the left,  improve=1.680070, (0 missing)
      WeekofPurchase &lt; 245       to the right, improve=1.384615, (0 missing)
      StoreID        &lt; 5.5       to the right, improve=1.319751, (0 missing)
  Surrogate splits:
      DiscCH      &lt; 0.27      to the right, agree=0.942, adj=0.625, (0 split)
      SalePriceCH &lt; 1.54      to the left,  agree=0.942, adj=0.625, (0 split)
      PctDiscCH   &lt; 0.149059  to the right, agree=0.942, adj=0.625, (0 split)
      SalePriceMM &lt; 1.64      to the left,  agree=0.923, adj=0.500, (0 split)
      DiscMM      &lt; 0.42      to the right, agree=0.904, adj=0.375, (0 split)

Node number 102: 8 observations
  predicted class=CH  expected loss=0.25  P(node) =0.01
    class counts:     6     2
   probabilities: 0.750 0.250 

Node number 103: 44 observations
  predicted class=MM  expected loss=0.3636364  P(node) =0.055
    class counts:    16    28
   probabilities: 0.364 0.636 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the tree model</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(tree_model, <span class="at">type =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Lab1-Exercise1_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="768"></p>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make predictions on the test data</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>test_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(tree_model, test_data, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create a confusion matrix</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="ot">&lt;-</span> <span class="fu">table</span>(test_data<span class="sc">$</span>Purchase, test_preds)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the test error rate</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>test_error_rate <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">sum</span>(<span class="fu">diag</span>(conf_matrix)) <span class="sc">/</span> <span class="fu">sum</span>(conf_matrix)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># use cross-validation to find the optimal tree size</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>cv_results <span class="ot">&lt;-</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> <span class="fu">seq</span>(<span class="fl">0.0001</span>, <span class="fl">0.01</span>, <span class="at">by =</span> <span class="fl">0.0001</span>))</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>cv_model <span class="ot">&lt;-</span> <span class="fu">rpart</span>(Purchase <span class="sc">~</span> ., <span class="at">data =</span> train_data, <span class="at">method =</span> <span class="st">"class"</span>, <span class="at">control =</span> cv_results)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plotcp</span>(cv_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Lab1-Exercise1_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid" width="768"></p>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prune the tree to the optimal size</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>optimal_cp <span class="ot">&lt;-</span> cv_model<span class="sc">$</span>cptable[<span class="fu">which.min</span>(cv_model<span class="sc">$</span>cptable[, <span class="st">"xerror"</span>]), <span class="st">"CP"</span>]</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>pruned_model <span class="ot">&lt;-</span> <span class="fu">prune</span>(tree_model, <span class="at">cp =</span> optimal_cp)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># compare training error rates between the pruned and unpruned trees</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>train_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(tree_model, train_data, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>train_error_rate_unpruned <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">sum</span>(<span class="fu">diag</span>(<span class="fu">table</span>(train_data<span class="sc">$</span>Purchase, train_preds))) <span class="sc">/</span> <span class="fu">nrow</span>(train_data)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>train_preds_pruned <span class="ot">&lt;-</span> <span class="fu">predict</span>(pruned_model, train_data, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>train_error_rate_pruned <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">sum</span>(<span class="fu">diag</span>(<span class="fu">table</span>(train_data<span class="sc">$</span>Purchase, train_preds_pruned))) <span class="sc">/</span> <span class="fu">nrow</span>(train_data)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Training error rate (unpruned):"</span>, train_error_rate_unpruned, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Training error rate (unpruned): 0.15 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Training error rate (pruned):"</span>, train_error_rate_pruned, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Training error rate (pruned): 0.15 </code></pre>
</div>
</div>
</section>
<section id="solution-using-caret" class="level1">
<h1>Solution using <code>caret</code></h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the necessary packages</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># load the OJ dataset</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(OJ)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># split the data into training and test sets</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>train_index <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(OJ<span class="sc">$</span>Purchase, <span class="at">p =</span> <span class="fl">0.8</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> OJ[train_index, ]</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> OJ[<span class="sc">-</span>train_index, ]</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="co"># fit a decision tree to the training data</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>ctrl <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"repeatedcv"</span>, <span class="at">number =</span> <span class="dv">10</span>, <span class="at">repeats =</span> <span class="dv">3</span>)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(Purchase <span class="sc">~</span> ., <span class="at">data =</span> train_data, <span class="at">method =</span> <span class="st">"rpart"</span>, <span class="at">trControl =</span> ctrl)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize the tree model</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model<span class="sc">$</span>finalModel)</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the tree model</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model<span class="sc">$</span>finalModel, <span class="at">main =</span> <span class="st">"Decision Tree"</span>)</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="co"># make predictions on the test data</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>test_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> test_data)</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="co"># create a confusion matrix</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="ot">&lt;-</span> <span class="fu">table</span>(test_data<span class="sc">$</span>Purchase, test_preds)</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the test error rate</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>test_error_rate <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">sum</span>(<span class="fu">diag</span>(conf_matrix)) <span class="sc">/</span> <span class="fu">sum</span>(conf_matrix)</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a><span class="co"># use cross-validation to find the optimal tree size</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>tune_grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">cp =</span> <span class="fu">seq</span>(<span class="fl">0.0001</span>, <span class="fl">0.01</span>, <span class="at">by =</span> <span class="fl">0.0001</span>))</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>tune_results <span class="ot">&lt;-</span> <span class="fu">train</span>(Purchase <span class="sc">~</span> ., <span class="at">data =</span> train_data, <span class="at">method =</span> <span class="st">"rpart"</span>, <span class="at">trControl =</span> ctrl, <span class="at">tuneGrid =</span> tune_grid)</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a><span class="co"># prune the tree to the optimal size</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>pruned_model <span class="ot">&lt;-</span> <span class="fu">prune</span>(tune_results<span class="sc">$</span>finalModel, <span class="at">cp =</span> tune_results<span class="sc">$</span>bestTune<span class="sc">$</span>cp)</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a><span class="co"># compare training error rates between the pruned and unpruned trees</span></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>train_preds_unpruned <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> train_data)</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>train_error_rate_unpruned <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">sum</span>(<span class="fu">diag</span>(<span class="fu">table</span>(train_data<span class="sc">$</span>Purchase, train_preds_unpruned))) <span class="sc">/</span> <span class="fu">nrow</span>(train_data)</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>train_preds_pruned <span class="ot">&lt;-</span> <span class="fu">predict</span>(pruned_model, <span class="at">newdata =</span> train_data)</span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>train_error_rate_pruned <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">sum</span>(<span class="fu">diag</span>(<span class="fu">table</span>(train_data<span class="sc">$</span>Purchase, train_preds_pruned))) <span class="sc">/</span> <span class="fu">nrow</span>(train_data)</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Training error rate (unpruned):"</span>, train_error_rate_unpruned, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Training error rate (pruned):"</span>, train_error_rate_pruned, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="references" class="level1">
<h1>References</h1>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>